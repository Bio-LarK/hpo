"use strict";angular.module("orphaApp",["ngAnimate","ngSanitize","ngResource","ui.router","truncate","restangular","ui.bootstrap","dotjem.angular.tree","ui.utils","ajoslin.promise-tracker","angular-loading-bar"]).run(["$rootScope","$http","$state","$stateParams","Page",function(a,b,c,d,e){a.$state=c,a.$stateParams=d,a.Page=e,a.getResults=function(a){var c=encodeURIComponent(a),d="http://130.56.248.140/orphanet/api/search_node/retrieve.json?keys="+c+"&simple=1";return b.get(d).then(function(a){return a.data})},a.changed=function(a,b,d){console.log(a,b,d);var e={},f=a.type.toLowerCase();"clinical sign"===f&&(f="sign"),e[f+"Id"]=a.node,c.go(f,e),console.log(f,e)}}]).config(["$stateProvider","$urlRouterProvider","RestangularProvider",function(a,b,c){c.setBaseUrl("http://130.56.248.140/orphanet/api"),b.otherwise("/disorders"),a.state("genes",{url:"/genes?page",controller:"GenesCtrl",templateUrl:"views/genes.html"}).state("gene",{url:"/gene/:geneId/disorders",controller:"GeneCtrl",templateUrl:"views/gene.html"}).state("sign",{url:"/sign/:signId/disorders",controller:"SignCtrl",templateUrl:"views/sign.html"}).state("signs",{url:"/signs",controller:"SignsCtrl",templateUrl:"views/signs.html"}).state("disorder",{url:"/disorders/:disorderId",controller:"DisorderCtrl",templateUrl:"views/disorder.html"}).state("disorders",{url:"/disorders?page?signId",controller:"DisordersCtrl",templateUrl:"views/disorders.html"}).state("concept",{url:"/concept/:conceptId",controller:function(a,b){var c=b.get({nid:136402},function(){a.disorder=c})},templateUrl:"views/concept.html"})}]),angular.module("orphaApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("orphaApp").factory("Concept",["Restangular",function(a){var b=a.service("entity_node");return b}]),angular.module("orphaApp").filter("inSlicesOf",["$rootScope",function(a){console.log("staring in slice of!!");var b=function(b,c){if(c||(c=3),!angular.isArray(b)&&!angular.isString(b))return b;for(var d=[],e=0;e<b.length;e++){var f=parseInt(e/c,10),g=e%c===0;g&&(d[f]=[]),d[f].push(b[e])}a.arraysinSliceOf=a.arraysinSliceOf||[];var h=null;return angular.forEach(a.arraysinSliceOf,function(a){angular.equals(a,d)&&(h=a)}),h?(console.log("no change"),h):(console.log("change"),a.arraysinSliceOf.push(d),d)};return b}]),angular.module("orphaApp").factory("Disorder",["$resource","$http","$q","RelationshipService",function(a,b,c,d){var e=a("http://130.56.248.140/orphanet/api/entity_node/:nid",{"parameters[type]":"disorder",nid:"@nid"},{get:{method:"GET",transformResponse:b.defaults.transformResponse.concat([function(a){return a.disorder_parent=_.map(a.disorder_parent,function(a){return new e(a)}),_.each(a.disorder_inheritance,function(a){a.label="Autosomal dominant"===a.toi_name?"AD":"Autosomal recessive"===a.toi_name?"AR":a.toi_name}),a}])}});return angular.extend(e.prototype,{getGenes:function(){var a=["disgene_as","disgene_at","disgene_gene"];return d.getRelatedThroughIntermediary(this,"disorder_disgene",a)},getSigns:function(){var a=["ds_sign","ds_frequency"];return d.getRelatedThroughIntermediary(this,"disorder_phenotype",a)},getParents:function(){var a=this,d=_.map(this.disorder_parent,function(a){return a.id||a.nid});if(!d.length)return c.when(null);var f=_.indexBy(d,function(a,b){return"parameters[nid]["+b+"]"});return f.fields=["nid","disorder_name","disorder_parent"].join(","),b.get("http://130.56.248.140/orphanet/api/entity_node",{params:f}).then(function(b){return a.disorder_parent=_.map(b.data,function(a){return new e(a)}),a.disorder_parent})}}),e.getFromSign=function(a){return b.get("http://130.56.248.140/orphanet/api/entity_node/"+a+"/nodes_field_ds_sign?fields=ds_disorder").then(function(a){var b=_.map(a.data,function(a){return new e(a.ds_disorder)});return b})},e.getFromGene=function(a){return b.get("http://130.56.248.140/orphanet/api/entity_node/"+a+"/nodes_field_disgene_gene?fields=disgene_disorder").then(function(a){var b=_.map(a.data,function(a){return new e(a.disgene_disorder)});return b})},e}]),angular.module("orphaApp").controller("DisorderCtrl",["$scope","$stateParams","Disorder","Page","promiseTracker",function(a,b,c,d,e){function f(){var e=c.get({nid:b.disorderId},function(b){a.disorder=b;var c=b.getGenes();a.genesTracker.addPromise(c);var e=b.getSigns();a.signsTracker.addPromise(e),d.setTitle(b.disorder_name)});a.disorderTracker.addPromise(e.$promise),a.signsTracker.addPromise(e.$promise),a.genesTracker.addPromise(e.$promise)}function g(a){a.isShowingParents=!a.isShowingParents,a.getParents().then(function(a){console.log("parents",a)})}a.disorderTracker=e(),a.signsTracker=e(),a.genesTracker=e(),a.toggleParents=g,f()}]),angular.module("orphaApp").factory("Gene",["$resource",function(a){var b=a("http://130.56.248.140/orphanet/api/entity_node/:nid",{"parameters[type]":"gene",nid:"@nid"});return angular.extend(b.prototype,{}),b}]),angular.module("orphaApp").service("RelationshipService",["$http","$q",function(a,b){this.getRelatedThroughIntermediary=function(c,d,e){var f=_.first(c[d]);if(!c[d].length)return b.when();var g=_.pluck(c[d],"nid"),h=_.indexBy(g,function(a,b){return"parameters[nid]["+b+"]"});return h["paramaters[type]"]=f.type,h.fields=["nid","type","title"].concat(e).join(","),a.get("http://130.56.248.140/orphanet/api/entity_node",{params:h}).then(function(a){var b=a.data;c[d]=b})}}]),angular.module("orphaApp").factory("Sign",["$resource","Gene","RelationshipService",function(a){var b=a("http://130.56.248.140/orphanet/api/entity_node/:nid",{"parameters[type]":"clinical_sign",nid:"@nid"});return angular.extend(b.prototype,{}),b}]),angular.module("orphaApp").controller("DisordersCtrl",["$scope","$timeout","$stateParams","promiseTracker","Disorder",function(a,b,c,d,e){function f(){a.disorders=e.query({fields:"nid,disorder_name",page:a.page++}),a.loadingTracker.addPromise(a.disorders.$promise)}function g(){var b=e.query({fields:"nid,disorder_name",page:a.page++},function(b){a.disorders=a.disorders.concat(b)});a.loadingTracker.addPromise(b.$promise)}a.loadMore=g,a.loadingTracker=d(),a.page=0,f()}]),angular.module("orphaApp").controller("GenesCtrl",["$scope","Gene","promiseTracker",function(a,b,c){function d(){a.genes=b.query({fields:"nid,gene_name,gene_symbol,gene_disgene",page:a.page++}),a.loadingTracker.addPromise(a.genes.$promise)}function e(){var c=b.query({fields:"nid,gene_name,gene_symbol,gene_disgene",page:a.page++},function(b){a.genes=a.genes.concat(b)});a.loadingTracker.addPromise(c.$promise)}a.loadMore=e,a.loadingTracker=c(),a.page=0,d()}]),angular.module("orphaApp").controller("GeneCtrl",["$scope","$stateParams","Gene","Disorder","promiseTracker",function(a,b,c,d,e){function f(){a.gene=c.get({nid:b.geneId}),a.geneTracker.addPromise(a.gene.$promise),a.disordersTracker.addPromise(a.gene.$promise);var e=d.getFromGene(b.geneId).then(function(b){a.disorders=b});a.disordersTracker.addPromise(e)}a.disordersTracker=e(),a.geneTracker=e(),f()}]),angular.module("orphaApp").factory("SearchService",function(){return{}}),angular.module("orphaApp").controller("SignCtrl",["$scope","$stateParams","Disorder","Sign","promiseTracker",function(a,b,c,d,e){function f(){a.sign=d.get({nid:b.signId}),a.signTracker.addPromise(a.sign);var e=c.getFromSign(b.signId).then(function(b){a.disorders=b});a.disordersTracker.addPromise(a.sign),a.disordersTracker.addPromise(e)}a.signTracker=e(),a.disordersTracker=e(),f()}]),angular.module("orphaApp").directive("cmTree",function(){return{templateUrl:"views/cmtree.html",restrict:"E",scope:{disorder:"="},link:function(){}}}),angular.module("orphaApp").factory("Page",function(){function a(a){b.title=a+" - Orphanet"}var b={title:null,setTitle:a};return b}),angular.module("orphaApp").controller("SignsCtrl",["$scope","Sign","promiseTracker",function(a,b,c){function d(){a.signs=b.query({fields:"nid,sign_name,sign_dissign"}),a.loadingTracker.addPromise(a.signs.$promise)}function e(){var c=b.query({fields:"nid,Sign_name",page:a.page++},function(b){a.signs=a.signs.concat(b)});a.loadingTracker.addPromise(c.$promise)}a.loadMore=e,a.loadingTracker=c(),a.page=0,d()}]);